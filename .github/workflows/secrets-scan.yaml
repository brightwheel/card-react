# GitHub Actions workflow that calls the brightwheel appsec-tooling reusable workflow for secrets
# scanning on protected branches.
#
# DEPENDENCIES:
#
#  * Organization-level Variable (Settings → Secrets and variables → Actions → Variables):
#    - APPSEC_SCANNER_PULL_ROLE_ARN: AWS IAM role ARN for ECR scanner image access via OIDC

name: Secrets Scan

on:
  # Automatic scanning on every push to PR branches
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]
    branches:
      - master
  # Manual trigger for testing
  workflow_dispatch:
    inputs:
      pr_number:
        description: "PR number to scan (optional)"
        required: false
      ref:
        description: "Branch/ref to scan (optional, defaults to current)"
        required: false

jobs:
  scan:
    if: github.event.pull_request.draft == false
    uses: brightwheel/appsec-tooling/.github/workflows/reusable-secrets-scan.yaml@main
    with:
      aws-role-arn: ${{ vars.APPSEC_SCANNER_PULL_ROLE_ARN }}
    secrets: inherit # passes org-level secrets
    # Optional inputs
    #  fail-on-findings: false  # currently defaults to false while scanning is rolling out. won't fail the build
    #  enable-comments: true    # default: true; posts PR comments on findings
